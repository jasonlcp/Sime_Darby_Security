<template>
    <div class="page">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="back link">
                        <i class="icon icon-back"></i>
                        <span class="if-not-md">Back</span>
                    </a>
                </div>
                <div class="center">
                    Schedule
                </div>
            </div>
        </div>

        <div class="toolbar toolbar-bottom auto-height">
            <div class="block">
                <a href="#" id="schedule_submit" class="button button-raised button-round button-fill ">Submit</a>
            </div>
        </div>
        <div class="page-content">
            <div class="block-title">
                <h3>Schedule Entry</h3>
            </div>
            <div class="list no-hairlines-md">
                <form id="scheduleForm">
                    <ul>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">House</div>
                                <div class="item-input-wrap input-dropdown-wrap">
                                    <a class="item-link smart-select smart-select-init" data-open-in="sheet">
                                        <div class="item-after"></div>
                                        <select name="house">
                                            {{#each properties}}
                                            <option value="{{id}}">{{name}}, {{street.area.name}}</option>
                                            {{else}}
                                            <option value="">Select a property</option>
                                            {{/each}}
                                        </select>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Name</div>
                                <div class="item-input-wrap">
                                    <input type="text" placeholder="Visitor's name" name="name"
                                        value="{{this.$route.params.name}}">
                                    <span class="input-clear-button"></span>
                                </div>
                            </div>
                        </li>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Vehicle Plate Number</div>
                                <div class="item-input-wrap">
                                    <input type="text" placeholder="Plate Number" name="car_plate"
                                        value="{{this.$route.params.plate}}">
                                    <span class="input-clear-button"></span>
                                </div>
                            </div>
                        </li>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Mobile Number</div>
                                <div class="item-input-wrap">
                                    <input type="text" placeholder="Mobile No." name="phone"
                                        value="{{this.$route.params.phone}}">
                                    <span class="input-clear-button"></span>
                                </div>
                            </div>
                        </li>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Entry Type</div>
                                <div class="item-input-wrap input-dropdown-wrap">
                                    <a id="entryid" class="item-link smart-select smart-select-init"
                                        data-open-in="sheet">
                                        <div class="item-after"></div>
                                        <select name="entry">
                                            <option value="single" selected>Single Entry</option>
                                            <option value="multiple">Multiple Entry</option>
                                            <option value="scheduled">Scheduled Entry</option>
                                        </select>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Entry Date</div>
                                <div class="item-input-wrap">
                                    <input name="entry_date" type="text" placeholder="Select date" readonly="readonly"
                                        id="entry_date" />
                                </div>
                            </div>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
    </div>
</template>
<style>
    .auto-height {
        --f7-toolbar-height: 100px;

    }

    .auto-height~* {
        --f7-page-toolbar-bottom-offset: 100px;
    }

    .item-content .item-link {
        height: var(--f7-input-height);
    }

    .item-content .item-link .item-after {
        padding-left: 0px;
        margin-left: 0px;
        top: 50%;
        transform: translateY(-50%);
    }
</style>
<script>
    import request from '../js/request.js';
    export default {
        on: {
            pageBeforeIn: function () {
                this.$app.methods.getProperties();
            },
            pageInit: function () {
                var app = this.$app;
                var $$ = this.$$;
                var schedule = false;
                var expCalendarModal;
                var entryCalendarModal;
                var today = new Date();
                var yesterday = new Date().setDate(today.getDate() - 1);
                $$("#entryid").on("smartselect:close", function () {
                    var val = $$(this).children('select').val();
                    if (val == 'scheduled') {
                        if (schedule == false) {
                            $$('#scheduleForm ul').append(
                                '<li class="item-content item-input added">' +
                                '<div class="item-inner">' +
                                '<div class="item-title item-label">Valid Until</div>' +
                                '<div class="item-input-wrap">' +
                                '<input name="exp_date" type="text" placeholder="Select date" readonly="readonly" id="exp_date" />' +
                                '</div>' +
                                '</div>' +
                                '</li>' +
                                '<li class="item-content item-input added">' +
                                '<div class="item-inner">' +
                                '<div class="item-title item-label">Day</div>' +
                                '<div class="item-input-wrap input-dropdown-wrap">' +
                                '<a href="#" class="item-link smart-select">' +
                                '<div class="item-after"></div>' +
                                '<select name="days" multiple>' +
                                '<option value="monday" selected data-display-as="Mon">Monday</option>' +
                                '<option value="tuesday" data-display-as="Tue">Tuesday</option>' +
                                '<option value="wednesday" data-display-as="Wed">Wednesday</option>' +
                                '<option value="thursday" data-display-as="Thu">Thursday</option>' +
                                '<option value="friday" data-display-as="Fri">Friday</option>' +
                                '<option value="saturday" data-display-as="Sat">Saturday</option>' +
                                '<option value="sunday" data-display-as="Sun">Sunday</option>' +
                                '</select>' +
                                '</a>' +
                                '</div>' +
                                '</div>' +

                                '</li>'
                            );
                            expCalendarModal = app.calendar.create({
                                inputEl: '#exp_date',
                                openIn: 'customModal',
                                header: true,
                                footer: true,
                                dateFormat: 'MM dd yyyy',
                                minDate: entryCalendarModal.getValue(),
                            });
                        }
                        schedule = true;
                    } else {
                        if (schedule == true) {
                            expCalendarModal.off('destroy');
                            expCalendarModal.destroy()
                            schedule = false;
                            $$('.added').remove();

                        }
                    }
                });
                entryCalendarModal = app.calendar.create({
                    inputEl: '#entry_date',
                    openIn: 'customModal',
                    header: true,
                    footer: true,
                    dateFormat: 'MM dd yyyy',
                    minDate: today,
                });
                entryCalendarModal.on('close', function () {
                    if (this.getValue() && expCalendarModal && !expCalendarModal.destroyed) {
                        if (expCalendarModal.params.minDate > entryCalendarModal.value || expCalendarModal
                            .value > entryCalendarModal.value) {
                            expCalendarModal.setValue(entryCalendarModal.getValue());
                        }
                        expCalendarModal.params.minDate = entryCalendarModal.value;

                    }
                });
            }
        }
    }
</script>